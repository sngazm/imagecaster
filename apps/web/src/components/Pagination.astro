---
interface Props {
  currentPage: number;
  totalPages: number;
  basePath?: string;
}

const { currentPage, totalPages, basePath = "" } = Astro.props;

function getPageUrl(page: number): string {
  if (page === 1) {
    return basePath || "/";
  }
  return `${basePath}/page/${page}`;
}

// ページ番号の配列を生成（省略記号を含む）
function getPageNumbers(): (number | "ellipsis")[] {
  const pages: (number | "ellipsis")[] = [];

  for (let page = 1; page <= totalPages; page++) {
    const showPage = page === 1 || page === totalPages || Math.abs(page - currentPage) <= 1;
    const showEllipsis = !showPage && (page === 2 || page === totalPages - 1);

    if (showPage) {
      pages.push(page);
    } else if (showEllipsis) {
      pages.push("ellipsis");
    }
  }

  return pages;
}

const pageNumbers = getPageNumbers();
---

{totalPages > 1 && (
  <nav class="mt-6 flex items-center justify-center gap-1.5" aria-label="ページネーション">
    {currentPage > 1 && (
      <a
        href={getPageUrl(currentPage - 1)}
        class="inline-flex items-center gap-1 rounded-md border border-border bg-bg-elevated px-2.5 py-1.5 text-xs font-medium text-text-secondary transition-colors hover:bg-bg-subtle dark:border-border-dark dark:bg-bg-elevated-dark dark:text-text-secondary-dark dark:hover:bg-bg-subtle-dark"
        aria-label="前のページ"
      >
        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        前へ
      </a>
    )}

    <div class="flex items-center gap-1">
      {pageNumbers.map((item, index) => {
        if (item === "ellipsis") {
          return <span class="px-1.5 text-xs text-text-faint dark:text-text-faint-dark">...</span>;
        }

        const isCurrentPage = item === currentPage;
        return (
          <a
            href={getPageUrl(item)}
            class={`inline-flex h-7 w-7 items-center justify-center rounded-md text-xs font-medium transition-colors ${
              isCurrentPage
                ? "bg-accent text-white"
                : "border border-border bg-bg-elevated text-text-secondary hover:bg-bg-subtle dark:border-border-dark dark:bg-bg-elevated-dark dark:text-text-secondary-dark dark:hover:bg-bg-subtle-dark"
            }`}
            aria-current={isCurrentPage ? "page" : undefined}
          >
            {item}
          </a>
        );
      })}
    </div>

    {currentPage < totalPages && (
      <a
        href={getPageUrl(currentPage + 1)}
        class="inline-flex items-center gap-1 rounded-md border border-border bg-bg-elevated px-2.5 py-1.5 text-xs font-medium text-text-secondary transition-colors hover:bg-bg-subtle dark:border-border-dark dark:bg-bg-elevated-dark dark:text-text-secondary-dark dark:hover:bg-bg-subtle-dark"
        aria-label="次のページ"
      >
        次へ
        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    )}
  </nav>
)}
