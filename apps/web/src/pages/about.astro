---
import Layout from "../layouts/Layout.astro";
import SubscribeSection from "../components/SubscribeSection.astro";
import { getPodcastIndex } from "../lib/api";
import { getPodcastOgImageUrl } from "../lib/og";

const index = await getPodcastIndex();
const podcast = index.podcast;

// OGP画像（ビルド時にダウンロードされたローカル画像を優先）
const siteUrl = Astro.site?.toString() || "";
const ogImageUrl = getPodcastOgImageUrl(siteUrl, podcast.ogImageUrl || podcast.artworkUrl);
---

<Layout title="番組について" description={podcast.description} ogImage={ogImageUrl}>
  <div class="mx-auto max-w-4xl px-4 py-8 sm:py-10">
    <div class="grid gap-6 lg:grid-cols-3 lg:gap-8">
      <div class="lg:col-span-2">
        <article class="rounded-lg border border-border bg-bg-elevated p-5 dark:border-border-dark dark:bg-bg-elevated-dark">
          <div class="mb-6 flex items-start gap-4">
            {podcast.artworkUrl && (
              <img
                src={podcast.artworkUrl}
                alt={podcast.title}
                class="h-24 w-24 shrink-0 rounded-lg shadow-md"
              />
            )}
            <div>
              <h1 class="mb-1 text-xl font-semibold text-text dark:text-text-dark">
                {podcast.title}
              </h1>
              {podcast.author && (
                <p class="text-sm text-text-secondary dark:text-text-secondary-dark">
                  by {podcast.author}
                </p>
              )}
            </div>
          </div>

          <div class="prose prose-sm prose-zinc dark:prose-invert max-w-none">
            <h2 class="text-base font-semibold">番組について</h2>
            <p class="text-text-secondary dark:text-text-secondary-dark">{podcast.description}</p>

            <h2 class="text-base font-semibold">番組情報</h2>
            <dl class="grid grid-cols-2 gap-3 not-prose">
              {podcast.category && (
                <>
                  <dt class="text-xs font-medium text-text-muted dark:text-text-muted-dark">カテゴリ</dt>
                  <dd class="text-xs text-text dark:text-text-dark">{podcast.category}</dd>
                </>
              )}
              {podcast.language && (
                <>
                  <dt class="text-xs font-medium text-text-muted dark:text-text-muted-dark">言語</dt>
                  <dd class="text-xs text-text dark:text-text-dark">{podcast.language}</dd>
                </>
              )}
              {podcast.email && (
                <>
                  <dt class="text-xs font-medium text-text-muted dark:text-text-muted-dark">お問い合わせ</dt>
                  <dd class="text-xs">
                    <a href={`mailto:${podcast.email}`} class="text-accent hover:text-accent-hover">
                      {podcast.email}
                    </a>
                  </dd>
                </>
              )}
              {podcast.websiteUrl && (
                <>
                  <dt class="text-xs font-medium text-text-muted dark:text-text-muted-dark">ウェブサイト</dt>
                  <dd class="text-xs">
                    <a href={podcast.websiteUrl} target="_blank" rel="noopener noreferrer" class="text-accent hover:text-accent-hover">
                      {podcast.websiteUrl}
                    </a>
                  </dd>
                </>
              )}
            </dl>
          </div>
        </article>
      </div>

      <aside>
        <SubscribeSection podcast={podcast} />
      </aside>
    </div>
  </div>
</Layout>
